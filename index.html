<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase 연동 블로그 자동화 시스템</title>
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #64748b;
            --success: #059669;
            --warning: #d97706;
            --error: #dc2626;
            --text: #0f172a;
            --bg: #ffffff;
            --card: #ffffff;
            --border: #e2e8f0;
            --gray: #64748b;
            --light-gray: #f8fafc;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            font-weight: 400;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: var(--card);
            color: var(--text);
            padding: 40px;
            border-radius: 16px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            font-weight: 700;
            color: var(--text);
        }

        .header p {
            font-size: 1.1rem;
            color: var(--gray);
            font-weight: 400;
        }

        .auth-section {
            background: var(--card);
            padding: 30px;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border);
            margin-bottom: 20px;
            text-align: center;
        }

        .auth-section.hidden {
            display: none;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .section-card {
            background: var(--card);
            padding: 24px;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border);
            transition: all 0.2s ease;
        }

        .section-card:hover {
            box-shadow: var(--shadow-lg);
        }

        .section-card h3 {
            color: var(--text);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .topic-input-area {
            margin-bottom: 20px;
        }

        .topic-input {
            width: 100%;
            min-height: 120px;
            padding: 16px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 0.95rem;
            resize: vertical;
            transition: all 0.2s ease;
            background: var(--light-gray);
            font-family: inherit;
        }

        .topic-input:focus {
            outline: none;
            border-color: var(--primary);
            background: var(--card);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .topic-input::placeholder {
            color: var(--gray);
        }

        .btn {
            background: var(--primary);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: var(--shadow-sm);
            margin-right: 8px;
            margin-bottom: 8px;
        }

        .btn:hover {
            background: #1d4ed8;
            box-shadow: var(--shadow-md);
            transform: translateY(-1px);
        }

        .btn:disabled {
            background: var(--gray);
            cursor: not-allowed;
            transform: none;
        }

        .btn.small {
            padding: 8px 16px;
            font-size: 0.8rem;
        }

        .btn.success {
            background: var(--success);
            box-shadow: 0 4px 15px rgba(5, 150, 105, 0.3);
        }

        .btn.secondary {
            background: var(--gray);
            box-shadow: 0 4px 15px rgba(107, 114, 128, 0.3);
        }

        .btn.danger {
            background: var(--error);
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
        }

        .firebase-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 16px;
            background: var(--light-gray);
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--gray);
        }

        .status-indicator.connected {
            background: var(--success);
            animation: pulse 2s infinite;
        }

        .status-indicator.error {
            background: var(--error);
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .topic-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .topic-item {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .topic-item:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
            transform: translateY(-1px);
        }

        .topic-item.completed {
            background: rgba(5, 150, 105, 0.05);
            border-color: var(--success);
        }

        .topic-item.in-progress {
            background: rgba(217, 119, 6, 0.05);
            border-color: var(--warning);
        }

        .topic-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .topic-status {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .status-icon {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }

        .status-pending {
            background: var(--gray);
        }

        .status-progress {
            background: var(--warning);
        }

        .status-completed {
            background: var(--success);
        }

        .topic-content {
            color: var(--gray);
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .topic-actions {
            margin-top: 10px;
            display: flex;
            gap: 8px;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .editor-panel {
            background: var(--card);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border);
        }

        .editor-header {
            background: var(--light-gray);
            color: var(--text);
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border);
        }

        .editor-body {
            padding: 25px;
        }

        .editor-content {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 24px;
            min-height: 400px;
            max-height: 600px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-family: 'Georgia', serif;
            line-height: 1.8;
            font-size: 0.95rem;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .progress-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 20px;
            background: var(--card);
            border-radius: 10px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-sm);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 500;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .alert.success {
            background: rgba(5, 150, 105, 0.1);
            color: var(--success);
            border: 1px solid rgba(5, 150, 105, 0.2);
        }

        .alert.warning {
            background: rgba(217, 119, 6, 0.1);
            color: var(--warning);
            border: 1px solid rgba(217, 119, 6, 0.2);
        }

        .alert.error {
            background: rgba(220, 38, 38, 0.1);
            color: var(--error);
            border: 1px solid rgba(220, 38, 38, 0.2);
        }

        .alert.info {
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary);
            border: 1px solid rgba(37, 99, 235, 0.2);
        }

        select, input, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.2s ease;
            background: var(--card);
            font-family: inherit;
        }

        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: var(--light-gray);
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Firebase SDK v8 (더 안정적인 버전) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-functions.js"></script>

    <div class="container">
        <header class="header">
            <h1>
                <span>🔥</span>
                Firebase 연동 블로그 자동화 시스템
                <span>✍️</span>
            </h1>
            <p>안전하고 동기화되는 클라우드 기반 블로그 자동화</p>
        </header>

        <!-- Firebase 연결 상태 -->
        <div class="firebase-status">
            <div class="status-indicator" id="firebaseStatus"></div>
            <span id="statusText">Firebase 연결 중...</span>
            <div style="flex: 1;"></div>
            <button class="btn small" onclick="testFirebaseConnection()">🔧 연결 테스트</button>
        </div>

        <!-- 로그인/회원가입 섹션 -->
        <div class="auth-section" id="authSection">
            <h2>🔐 로그인 또는 회원가입</h2>
            <p style="margin-bottom: 20px; color: var(--gray);">
                Firebase 계정으로 로그인하면 모든 데이터가 안전하게 클라우드에 저장됩니다.
            </p>

            <div id="loginForm">
                <div class="form-group">
                    <input type="email" id="loginEmail" placeholder="이메일 주소" style="margin-bottom: 10px;">
                    <input type="password" id="loginPassword" placeholder="비밀번호">
                </div>
                <button class="btn success" onclick="loginWithEmail()">📧 이메일로 로그인</button>
                <button class="btn" onclick="signupWithEmail()">📝 회원가입</button>
                <button class="btn secondary" onclick="loginWithGoogle()">🔍 Google로 로그인</button>
            </div>

            <div style="margin-top: 20px;">
                <button class="btn small secondary" onclick="continueOffline()">
                    📱 오프라인 모드로 계속 (LocalStorage)
                </button>
            </div>
        </div>

        <!-- 사용자 정보 -->
        <div class="user-info hidden" id="userInfo">
            <div class="user-avatar" id="userAvatar">U</div>
            <div>
                <div id="userName">사용자</div>
                <small id="userEmail" style="color: var(--gray);">user@example.com</small>
            </div>
            <div style="flex: 1;"></div>
            <button class="btn small secondary" onclick="logout()">🚪 로그아웃</button>
        </div>

        <div class="main-grid hidden" id="mainContent">
            <!-- 사이드바: 주제 관리 -->
            <div class="sidebar">
                <!-- 새 주제 추가 -->
                <div class="section-card">
                    <h3>📝 새 주제 추가</h3>
                    <div class="topic-input-area">
                        <textarea 
                            class="topic-input" 
                            id="newTopicInput"
                            placeholder="이런 글을 쓰고 싶어요! 예시:

📌 겨울철 모발 관리 꿀팁
- 건조한 겨울 공기 때문에 머리가 너무 푸석해짐
- 정전기도 심하고 윤기도 없어짐  
- 실내외 온도차로 인한 두피 트러블
- 간단하면서도 효과적인 관리법 알려주기

📌 20대를 위한 헤어케어 루틴
- 대학생이나 직장 초년생들이 쉽게 따라할 수 있는
- 비용 부담 적으면서도 효과 좋은 제품들
- 바쁜 일상 속에서도 할 수 있는 간단한 방법들

이런 식으로 추상적으로 써주세요!"></textarea>
                    </div>
                    <button class="btn" onclick="addNewTopic()">
                        ➕ 주제 추가하기
                    </button>
                    <button class="btn secondary small" onclick="showBatchAdd()">
                        📦 여러 개 한번에 추가
                    </button>
                </div>

                <!-- AI 설정 -->
                <div class="section-card">
                    <h3>🤖 AI 설정</h3>
                    
                    <div class="form-group">
                        <label for="aiProvider">글 생성 AI 선택</label>
                        <select id="aiProvider">
                            <option value="claude">Claude (Anthropic)</option>
                            <option value="gpt">GPT-4 (OpenAI)</option>
                            <option value="both">둘 다 사용</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="claudeKey">Claude API 키</label>
                        <input type="password" id="claudeKey" placeholder="sk-ant-...">
                        <small style="color: var(--gray);">글 생성용 (글당 약 10원)</small>
                    </div>

                    <div class="form-group">
                        <label for="openaiKey">OpenAI API 키</label>
                        <input type="password" id="openaiKey" placeholder="sk-...">
                        <small style="color: var(--gray);">이미지 생성용 (이미지당 약 50원)</small>
                    </div>

                    <button class="btn small" onclick="saveAPIKeys()">💾 API 키 저장</button>
                    <button class="btn small secondary" onclick="testAPIConnection()">🧪 API 테스트</button>
                </div>

                <!-- 진행 현황 -->
                <div class="section-card">
                    <h3>📊 진행 현황</h3>
                    <div class="progress-stats">
                        <div class="stat-item">
                            <div class="stat-value" id="totalTopics">0</div>
                            <div class="stat-label">전체 주제</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="completedTopics">0</div>
                            <div class="stat-label">완료</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="pendingTopics">0</div>
                            <div class="stat-label">대기 중</div>
                        </div>
                    </div>
                    
                    <button class="btn success" onclick="startBatchGeneration()">
                        ⚡ 전체 자동 생성 시작
                    </button>
                </div>

                <!-- 글쓰기 스타일 학습 -->
                <div class="section-card">
                    <h3>🎨 내 글쓰기 스타일 학습</h3>
                    <p style="color: var(--gray); font-size: 0.9rem; margin-bottom: 15px;">
                        내가 쓴 글의 일부를 입력하면, AI가 그 스타일을 학습해서 비슷하게 써줍니다.
                    </p>
                    
                    <div class="style-samples" id="styleSamples">
                        <!-- 샘플 텍스트들이 여기에 추가됨 -->
                    </div>
                    
                    <textarea 
                        id="styleInput" 
                        class="topic-input" 
                        style="min-height: 80px;"
                        placeholder="내가 쓴 글의 일부를 붙여넣어주세요..."></textarea>
                    
                    <button class="btn small" onclick="addStyleSample()">
                        ✨ 스타일 샘플 추가
                    </button>
                    <button class="btn secondary small" onclick="analyzeWritingStyle()">
                        🔍 스타일 분석
                    </button>
                </div>
            </div>

            <!-- 메인 콘텐츠: 주제 목록 + 에디터 -->
            <div class="main-content">
                <!-- 주제 목록 -->
                <div class="section-card">
                    <h3>📋 내 주제 목록</h3>
                    <div class="topic-list" id="topicList">
                        <!-- 주제들이 여기에 동적으로 추가됨 -->
                    </div>
                </div>

                <!-- AI 에디터 -->
                <div class="editor-panel">
                    <div class="editor-header">
                        <div>
                            <h3 id="editorTitle">✍️ AI 글쓰기 에디터</h3>
                            <p id="editorSubtitle">주제를 선택하면 AI가 내 스타일로 글을 써줍니다</p>
                        </div>
                        <div>
                            <button class="btn secondary small" onclick="saveCurrentPost()">💾 저장</button>
                            <button class="btn success small" onclick="publishPost()">🚀 발행</button>
                        </div>
                    </div>
                    
                    <div class="editor-body">
                        <div class="loading" id="generationLoading">
                            <div class="spinner"></div>
                            <p>AI가 당신의 스타일로 글을 작성하고 있습니다...</p>
                            <p><small>평균 30-60초 소요됩니다</small></p>
                        </div>
                        
                        <div class="editor-content" id="editorContent">
                            Firebase에 로그인하면 모든 데이터가 안전하게 클라우드에 저장됩니다.
                            
                            📝 주요 개선사항:
                            ✅ 실시간 동기화 - 여러 기기에서 동일한 데이터
                            ✅ 안전한 백업 - 데이터 유실 걱정 없음
                            ✅ 보안 강화 - API 키 암호화 저장
                            ✅ 팀 협업 - 권한 관리 시스템
                            ✅ 확장성 - 대량 데이터 처리 가능
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase 설정 - 실제 프로젝트 연결됨
        const firebaseConfig = {
            apiKey: "AIzaSyDd19AiwV3-mD0f6qSwEVo8pPpcNMbj60s",
            authDomain: "blog-automation-b1856.firebaseapp.com",
            projectId: "blog-automation-b1856",
            storageBucket: "blog-automation-b1856.firebasestorage.app",
            messagingSenderId: "1080912696882",
            appId: "1:1080912696882:web:c11b9b3f2500bc339a8e2b",
            measurementId: "G-5TCJGH7D74"
        };

        // Firebase 초기화
        let app, auth, db, functions;
        let currentUser = null;
        let topics = [];
        let writingStyleSamples = [];
        let currentTopicId = null;
        let currentPost = null;
        let offlineMode = false;

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🔄 페이지 로드 완료, Firebase 확인 중...');
            
            // Firebase SDK 로딩 상태 확인
            checkFirebaseSDK();
        });

        // Firebase SDK 로딩 확인 및 재시도
        function checkFirebaseSDK() {
            let attempts = 0;
            const maxAttempts = 10;
            
            const checkInterval = setInterval(() => {
                attempts++;
                console.log(`🔍 Firebase SDK 확인 시도 ${attempts}/${maxAttempts}`);
                
                if (typeof firebase !== 'undefined') {
                    console.log('✅ Firebase SDK 로드 성공!');
                    clearInterval(checkInterval);
                    initializeFirebase();
                } else if (attempts >= maxAttempts) {
                    console.error('❌ Firebase SDK 로드 실패 - 최대 시도 초과');
                    clearInterval(checkInterval);
                    showFirebaseLoadError();
                }
            }, 500); // 0.5초마다 체크
        }

        // Firebase 로딩 실패 처리
        function showFirebaseLoadError() {
            updateFirebaseStatus('error', '❌ Firebase SDK 로드 실패');
            
            showAlert('error', `❌ Firebase SDK를 불러올 수 없습니다.

🔧 해결 방법을 시도해보세요:

1️⃣ 인터넷 연결 확인
2️⃣ 브라우저 캐시 삭제 (Ctrl+Shift+Delete)
3️⃣ 페이지 강제 새로고침 (Ctrl+F5)
4️⃣ 다른 브라우저에서 시도
5️⃣ VPN 사용 중이면 끄기
6️⃣ 광고 차단기 일시 비활성화

또는 오프라인 모드로 계속 사용하실 수 있습니다.`);
            
            // 수동 로딩 버튼 표시
            showManualLoadOption();
        }

        // 수동 Firebase 로딩 옵션
        function showManualLoadOption() {
            const firebaseStatus = document.querySelector('.firebase-status');
            
            if (firebaseStatus) {
                firebaseStatus.innerHTML = `
                    <div class="status-indicator error"></div>
                    <span>Firebase SDK 로드 실패</span>
                    <div style="flex: 1;"></div>
                    <button class="btn small" onclick="retryFirebaseLoad()">🔄 다시 시도</button>
                    <button class="btn small secondary" onclick="continueOffline()">📱 오프라인 모드</button>
                `;
            }
        }

        // Firebase 재로딩 시도
        function retryFirebaseLoad() {
            console.log('🔄 Firebase 재로딩 시도...');
            updateFirebaseStatus('warning', '🔄 Firebase 재연결 중...');
            
            // 기존 스크립트 제거
            const existingScripts = document.querySelectorAll('script[src*="firebasejs"]');
            existingScripts.forEach(script => script.remove());
            
            // 새로운 스크립트 로드
            loadFirebaseScripts();
        }

        // Firebase 스크립트 동적 로드
        function loadFirebaseScripts() {
            const scripts = [
                'https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js',
                'https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js',
                'https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js',
                'https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js'
            ];
            
            let loadedCount = 0;
            
            scripts.forEach((src, index) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = () => {
                    loadedCount++;
                    console.log(`✅ Firebase 스크립트 ${loadedCount}/${scripts.length} 로드됨`);
                    
                    if (loadedCount === scripts.length) {
                        console.log('🎉 모든 Firebase 스크립트 로드 완료!');
                        setTimeout(() => {
                            checkFirebaseSDK();
                        }, 1000);
                    }
                };
                script.onerror = () => {
                    console.error(`❌ Firebase 스크립트 로드 실패: ${src}`);
                };
                document.head.appendChild(script);
            });
        }

        // Firebase 초기화 (v8 문법)
        function initializeFirebase() {
            try {
                // Firebase 전역 객체 재확인
                if (typeof firebase === 'undefined') {
                    throw new Error('Firebase 전역 객체가 없습니다.');
                }

                console.log('🔥 Firebase 초기화 시작...');
                console.log('📦 사용 가능한 Firebase 서비스:', Object.keys(firebase));
                
                // Firebase 앱 초기화
                app = firebase.initializeApp(firebaseConfig);
                
                // 각 서비스 초기화
                if (firebase.auth) {
                    auth = firebase.auth();
                    console.log('✅ Firebase Auth 초기화 완료');
                } else {
                    console.warn('⚠️ Firebase Auth 서비스 없음');
                }
                
                if (firebase.firestore) {
                    db = firebase.firestore();
                    console.log('✅ Firestore 초기화 완료');
                } else {
                    console.warn('⚠️ Firestore 서비스 없음');
                }
                
                if (firebase.storage) {
                    console.log('✅ Firebase Storage 사용 가능');
                }
                
                if (firebase.functions) {
                    functions = firebase.functions();
                    console.log('✅ Firebase Functions 초기화 완료');
                }

                // 인증 상태 변화 감지
                if (auth) {
                    auth.onAuthStateChanged(onAuthStateChanged);
                }

                updateFirebaseStatus('connected', `✅ Firebase 연결됨 (${firebaseConfig.projectId})`);
                console.log('✅ Firebase 완전 초기화 성공!');

                showAlert('success', `🎉 Firebase 연결 성공!
                
📦 프로젝트: ${firebaseConfig.projectId}
✅ Authentication: ${auth ? '활성화' : '비활성화'}
✅ Firestore: ${db ? '활성화' : '비활성화'}
✅ Storage: ${firebase.storage ? '활성화' : '비활성화'}

🚀 이제 Google 로그인을 시도하거나 연결 테스트를 해보세요!`);

            } catch (error) {
                console.error('❌ Firebase 초기화 실패:', error);
                updateFirebaseStatus('error', 'Firebase 초기화 실패: ' + error.message);
                
                showAlert('error', `❌ Firebase 초기화 실패

오류: ${error.message}

🔧 문제 해결:
1. Firebase 콘솔에서 서비스 활성화 확인
2. 설정 정보 재확인
3. 네트워크 연결 상태 확인
4. 브라우저 콘솔에서 자세한 오류 확인`);
                
                showOfflineOption();
            }
        }

        // Firebase 데모 모드
        function showFirebaseDemo() {
            updateFirebaseStatus('warning', 'Firebase 데모 모드 (실제 연결 위해 설정 필요)');
            showAlert('warning', `
🔧 Firebase 설정이 필요합니다!

실제 사용을 위해 다음 단계를 완료하세요:

1. Firebase 콘솔에서 프로젝트 생성
2. Authentication 활성화 (Google, Email)
3. Firestore Database 생성
4. 설정 정보를 코드에 입력

현재는 데모 모드로 작동합니다.
            `);
            
            // 데모용 사용자 정보 표시
            setTimeout(() => {
                showUserInfo({
                    uid: 'demo-user',
                    email: 'demo@example.com',
                    displayName: 'Demo User'
                });
                loadDemoData();
            }, 2000);
        }

        // 인증 상태 변화 처리
        function onAuthStateChanged(user) {
            if (user) {
                currentUser = user;
                showUserInfo(user);
                loadUserData();
            } else {
                currentUser = null;
                showAuthSection();
            }
        }

        // 사용자 정보 표시
        function showUserInfo(user) {
            document.getElementById('authSection').classList.add('hidden');
            document.getElementById('userInfo').classList.remove('hidden');
            document.getElementById('mainContent').classList.remove('hidden');

            document.getElementById('userName').textContent = user.displayName || '사용자';
            document.getElementById('userEmail').textContent = user.email;
            document.getElementById('userAvatar').textContent = (user.displayName || user.email || 'U')[0].toUpperCase();

            showAlert('success', `환영합니다, ${user.displayName || user.email}님! 🎉`);
        }

        // 로그인 섹션 표시
        function showAuthSection() {
            document.getElementById('authSection').classList.remove('hidden');
            document.getElementById('userInfo').classList.add('hidden');
            document.getElementById('mainContent').classList.add('hidden');
        }

        // 이메일 로그인
        async function loginWithEmail() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showAlert('warning', '이메일과 비밀번호를 입력해주세요.');
                return;
            }

            try {
                await auth.signInWithEmailAndPassword(email, password);
                showAlert('success', '로그인 성공!');
            } catch (error) {
                showAlert('error', '로그인 실패: ' + error.message);
            }
        }

        // 이메일 회원가입
        async function signupWithEmail() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showAlert('warning', '이메일과 비밀번호를 입력해주세요.');
                return;
            }

            if (password.length < 6) {
                showAlert('warning', '비밀번호는 6자 이상이어야 합니다.');
                return;
            }

            try {
                await auth.createUserWithEmailAndPassword(email, password);
                showAlert('success', '회원가입 성공!');
            } catch (error) {
                showAlert('error', '회원가입 실패: ' + error.message);
            }
        }

        // Google 로그인
        async function loginWithGoogle() {
            if (!auth) {
                showAlert('error', 'Firebase가 초기화되지 않았습니다.');
                return;
            }

            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                await auth.signInWithPopup(provider);
                showAlert('success', 'Google 로그인 성공!');
            } catch (error) {
                showAlert('error', 'Google 로그인 실패: ' + error.message);
            }
        }

        // 로그아웃
        async function logout() {
            try {
                if (auth && currentUser) {
                    await auth.signOut();
                }
                currentUser = null;
                topics = [];
                writingStyleSamples = [];
                showAuthSection();
                showAlert('info', '로그아웃되었습니다.');
            } catch (error) {
                showAlert('error', '로그아웃 실패: ' + error.message);
            }
        }

        // 오프라인 모드 계속
        function continueOffline() {
            offlineMode = true;
            updateFirebaseStatus('warning', '오프라인 모드 (LocalStorage 사용)');
            
            showUserInfo({
                uid: 'offline-user',
                email: 'offline@local.com',
                displayName: '오프라인 사용자'
            });

            loadOfflineData();
            showAlert('warning', '⚠️ 오프라인 모드입니다. 데이터는 로컬에만 저장됩니다.');
        }

        // Firebase 연결 테스트 (v8 문법)
        async function testFirebaseConnection() {
            if (typeof firebase === 'undefined') {
                showAlert('error', '❌ Firebase SDK가 로드되지 않았습니다. 다시 시도 버튼을 클릭하세요.');
                return;
            }

            if (!db) {
                showAlert('error', '❌ Firestore가 초기화되지 않았습니다.');
                return;
            }

            try {
                updateFirebaseStatus('warning', '🔄 Firebase 연결 테스트 중...');
                
                console.log('🧪 Firestore 연결 테스트 시작...');
                
                // Firestore 연결 테스트
                const testCollection = db.collection('test');
                const testDoc = testCollection.doc('connection');
                
                await testDoc.set({
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    test: true,
                    projectId: firebaseConfig.projectId,
                    userAgent: navigator.userAgent,
                    testTime: new Date().toISOString()
                });

                console.log('✅ Firestore 쓰기 테스트 성공');

                // 테스트 문서 읽기
                const doc = await testDoc.get();
                if (doc.exists) {
                    console.log('✅ Firestore 읽기 테스트 성공');
                    console.log('📄 테스트 데이터:', doc.data());
                }

                // 테스트 문서 삭제
                await testDoc.delete();
                console.log('✅ Firestore 삭제 테스트 성공');
                
                updateFirebaseStatus('connected', '✅ Firebase 완전 연결됨 (모든 테스트 통과)');
                
                showAlert('success', `🎉 Firebase 연결 테스트 완료!
                
✅ Firebase SDK: 정상 로드
✅ 프로젝트 연결: ${firebaseConfig.projectId}
✅ Firestore 읽기: 정상
✅ Firestore 쓰기: 정상
✅ Firestore 삭제: 정상
✅ 서버 시간 동기화: 정상

🚀 이제 완전히 준비되었습니다!
Authentication과 Storage도 활성화하면 모든 기능을 사용할 수 있어요.`);

            } catch (error) {
                console.error('❌ Firebase 연결 테스트 실패:', error);
                updateFirebaseStatus('error', `Firebase 테스트 실패: ${error.code || error.message}`);
                
                let errorMessage = '❌ Firebase 연결 테스트 실패\n\n';
                let solutions = '';
                
                if (error.code === 'permission-denied') {
                    errorMessage += '🔒 권한 거부: Firestore 보안 규칙 문제';
                    solutions = `📋 해결 방법:
1. Firebase 콘솔 → Firestore Database 생성
2. 보안 규칙을 "테스트 모드"로 설정:

allow read, write: if request.time < timestamp.date(2024, 12, 31);

3. 또는 Authentication 먼저 활성화`;
                    
                } else if (error.code === 'unavailable' || error.code === 'deadline-exceeded') {
                    errorMessage += '🌐 네트워크 오류: Firestore 서비스에 연결할 수 없음';
                    solutions = `📋 해결 방법:
1. 인터넷 연결 확인
2. Firebase 콘솔에서 Firestore Database 생성했는지 확인
3. VPN 사용 중이면 잠시 끄기
4. 잠시 후 다시 시도`;
                    
                } else if (error.code === 'failed-precondition') {
                    errorMessage += '⚙️ 설정 오류: Firestore가 아직 설정되지 않음';
                    solutions = `📋 해결 방법:
1. Firebase 콘솔 접속
2. Firestore Database → "데이터베이스 만들기"
3. 테스트 모드 선택
4. 위치: asia-northeast3 (서울) 선택`;
                    
                } else {
                    errorMessage += `❓ 알 수 없는 오류
코드: ${error.code || 'unknown'}
메시지: ${error.message}`;
                    solutions = `📋 해결 방법:
1. 브라우저 콘솔에서 자세한 오류 확인
2. Firebase 콘솔에서 모든 서비스 상태 확인
3. 프로젝트 설정 재확인`;
                }
                
                showAlert('error', errorMessage + '\n\n' + solutions);
            }
        }

        // Firebase 상태 업데이트
        function updateFirebaseStatus(status, text) {
            const indicator = document.getElementById('firebaseStatus');
            const statusText = document.getElementById('statusText');

            indicator.className = 'status-indicator';
            if (status === 'connected') {
                indicator.classList.add('connected');
            } else if (status === 'error') {
                indicator.classList.add('error');
            }

            statusText.textContent = text;
        }

        // 사용자 데이터 로드 (Firebase)
        async function loadUserData() {
            if (!currentUser || !db || offlineMode) {
                loadOfflineData();
                return;
            }

            try {
                const userId = currentUser.uid;

                // 주제 데이터 로드
                const topicsSnapshot = await db.collection('users').doc(userId).collection('topics').orderBy('createdAt', 'desc').get();
                topics = topicsSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));

                // 스타일 샘플 로드
                const stylesSnapshot = await db.collection('users').doc(userId).collection('writingStyles').get();
                writingStyleSamples = stylesSnapshot.docs.map(doc => doc.data().content);

                updateUI();
                showAlert('success', '💾 클라우드에서 데이터를 불러왔습니다.');

            } catch (error) {
                console.error('데이터 로드 실패:', error);
                showAlert('error', '데이터 로드 실패: ' + error.message);
                loadOfflineData(); // 실패시 오프라인 모드로
            }
        }

        // 오프라인 데이터 로드
        function loadOfflineData() {
            const savedTopics = localStorage.getItem('blog_topics');
            const savedStyles = localStorage.getItem('writing_style_samples');
            
            if (savedTopics) {
                topics = JSON.parse(savedTopics);
            }
            
            if (savedStyles) {
                writingStyleSamples = JSON.parse(savedStyles);
            }

            updateUI();
        }

        // 데모 데이터 로드
        function loadDemoData() {
            topics = [
                {
                    id: 'demo-1',
                    content: '📌 겨울철 모발 관리 꿀팁\n- 건조한 겨울 공기 때문에 머리가 너무 푸석해짐\n- 정전기도 심하고 윤기도 없어짐\n- 간단하면서도 효과적인 관리법 알려주기',
                    status: 'pending',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'demo-2',
                    content: '📌 20대를 위한 헤어케어 루틴\n- 대학생이나 직장 초년생들이 쉽게 따라할 수 있는\n- 비용 부담 적으면서도 효과 좋은 제품들',
                    status: 'completed',
                    createdAt: new Date().toISOString(),
                    generatedPost: {
                        title: '20대를 위한 완벽한 헤어케어 루틴',
                        content: '안녕하세요! 오늘은 20대를 위한 헤어케어 루틴에 대해 말씀드리려고 해요...',
                        quality: 95
                    }
                }
            ];

            writingStyleSamples = [
                '안녕하세요! 헤어케어 덕후 민지입니다 😊 오늘은 정말정말 중요한 얘기를 해보려고 해요. 겨울만 되면 머리가 완전 짚단이 되는 분들 있죠? 저도 예전엔 그랬거든요 ㅠㅠ'
            ];

            updateUI();
        }

        // UI 업데이트
        function updateUI() {
            renderTopicList();
            renderStyleSamples();
            updateStats();
        }

        // 새 주제 추가
        async function addNewTopic() {
            const input = document.getElementById('newTopicInput');
            const content = input.value.trim();
            
            if (!content) {
                showAlert('warning', '주제 내용을 입력해주세요.');
                return;
            }

            const newTopic = {
                content: content,
                status: 'pending',
                createdAt: new Date().toISOString(),
                generatedPost: null,
                quality: null
            };

            try {
                if (currentUser && db && !offlineMode) {
                    // Firebase에 저장
                    const docRef = await db.collection('users').doc(currentUser.uid).collection('topics').add(newTopic);
                    newTopic.id = docRef.id;
                } else {
                    // 오프라인 모드
                    newTopic.id = Date.now().toString();
                }

                topics.unshift(newTopic);
                input.value = '';
                
                saveOfflineData();
                updateUI();
                
                showAlert('success', '새 주제가 추가되었습니다!');

            } catch (error) {
                showAlert('error', '주제 추가 실패: ' + error.message);
            }
        }

        // API 키 저장
        async function saveAPIKeys() {
            const claudeKey = document.getElementById('claudeKey').value;
            const openaiKey = document.getElementById('openaiKey').value;

            if (!claudeKey && !openaiKey) {
                showAlert('warning', 'API 키를 입력해주세요.');
                return;
            }

            try {
                if (currentUser && db && !offlineMode) {
                    // Firebase에 암호화하여 저장 (실제로는 Cloud Functions 사용 권장)
                    await db.collection('users').doc(currentUser.uid).set({
                        apiKeys: {
                            claude: claudeKey ? '암호화됨' : null,
                            openai: openaiKey ? '암호화됨' : null,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        }
                    }, { merge: true });

                    showAlert('success', '🔐 API 키가 안전하게 저장되었습니다!');
                } else {
                    // 오프라인 모드는 보안상 권장하지 않음
                    localStorage.setItem('api_keys', JSON.stringify({
                        claude: claudeKey,
                        openai: openaiKey
                    }));
                    showAlert('warning', '⚠️ 오프라인 모드에서는 API 키가 안전하지 않게 저장됩니다.');
                }

            } catch (error) {
                showAlert('error', 'API 키 저장 실패: ' + error.message);
            }
        }

        // API 연결 테스트
        async function testAPIConnection() {
            const claudeKey = document.getElementById('claudeKey').value;
            const openaiKey = document.getElementById('openaiKey').value;

            if (!claudeKey && !openaiKey) {
                showAlert('warning', '테스트할 API 키를 입력해주세요.');
                return;
            }

            let results = [];

            // Claude API 테스트
            if (claudeKey) {
                try {
                    const response = await fetch('https://api.anthropic.com/v1/messages', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'x-api-key': claudeKey,
                            'anthropic-version': '2023-06-01'
                        },
                        body: JSON.stringify({
                            model: 'claude-3-haiku-20240307',
                            max_tokens: 10,
                            messages: [{ role: 'user', content: 'Test' }]
                        })
                    });

                    if (response.ok) {
                        results.push('✅ Claude API 연결 성공');
                    } else {
                        results.push('❌ Claude API 연결 실패');
                    }
                } catch (error) {
                    results.push('❌ Claude API 오류: ' + error.message);
                }
            }

            // OpenAI API 테스트
            if (openaiKey) {
                try {
                    const response = await fetch('https://api.openai.com/v1/models', {
                        headers: {
                            'Authorization': `Bearer ${openaiKey}`
                        }
                    });

                    if (response.ok) {
                        results.push('✅ OpenAI API 연결 성공');
                    } else {
                        results.push('❌ OpenAI API 연결 실패');
                    }
                } catch (error) {
                    results.push('❌ OpenAI API 오류: ' + error.message);
                }
            }

            showAlert('info', '🧪 API 연결 테스트 결과:\n\n' + results.join('\n'));
        }

        // 스타일 샘플 추가
        async function addStyleSample() {
            const input = document.getElementById('styleInput');
            const text = input.value.trim();
            
            if (!text) {
                showAlert('warning', '스타일 샘플을 입력해주세요.');
                return;
            }

            try {
                if (currentUser && db && !offlineMode) {
                    // Firebase에 저장
                    await db.collection('users').doc(currentUser.uid).collection('writingStyles').add({
                        content: text,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }

                writingStyleSamples.push(text);
                input.value = '';
                
                saveOfflineData();
                renderStyleSamples();
                
                showAlert('success', '글쓰기 스타일이 추가되었습니다!');

            } catch (error) {
                showAlert('error', '스타일 추가 실패: ' + error.message);
            }
        }

        // 오프라인 데이터 저장
        function saveOfflineData() {
            if (offlineMode || !currentUser) {
                localStorage.setItem('blog_topics', JSON.stringify(topics));
                localStorage.setItem('writing_style_samples', JSON.stringify(writingStyleSamples));
            }
        }

        // 주제 목록 렌더링
        function renderTopicList() {
            const container = document.getElementById('topicList');
            
            if (topics.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--gray);">
                        <p>🤔 아직 추가된 주제가 없어요.</p>
                        <p>왼쪽에서 쓰고 싶은 주제를 추가해보세요!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = topics.map(topic => `
                <div class="topic-item ${topic.status}" onclick="selectTopic('${topic.id}')">
                    <div class="topic-header">
                        <div class="topic-status">
                            <div class="status-icon status-${getStatusClass(topic.status)}"></div>
                            ${getStatusText(topic.status)}
                        </div>
                        <small style="color: var(--gray);">${formatDate(topic.createdAt)}</small>
                    </div>
                    <div class="topic-content">
                        ${topic.content.length > 120 ? topic.content.substring(0, 120) + '...' : topic.content}
                    </div>
                    <div class="topic-actions">
                        <button class="btn small" onclick="event.stopPropagation(); generatePost('${topic.id}')">
                            ${topic.status === 'completed' ? '🔄 재생성' : '✨ 글 생성'}
                        </button>
                        ${topic.status === 'completed' ? `
                            <button class="btn success small" onclick="event.stopPropagation(); publishPost('${topic.id}')">
                                🚀 발행
                            </button>
                        ` : ''}
                        <button class="btn danger small" onclick="event.stopPropagation(); deleteTopic('${topic.id}')">
                            🗑️
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // 스타일 샘플 렌더링
        function renderStyleSamples() {
            const container = document.getElementById('styleSamples');
            
            if (writingStyleSamples.length === 0) {
                container.innerHTML = '<p style="color: var(--gray); font-size: 0.9rem;">아직 추가된 스타일 샘플이 없어요.</p>';
                return;
            }

            container.innerHTML = writingStyleSamples.map((sample, index) => `
                <div style="background: var(--light-gray); border: 1px solid var(--border); border-radius: 6px; padding: 12px; margin-bottom: 10px; font-size: 0.9rem; position: relative;">
                    <button style="position: absolute; top: 5px; right: 8px; background: none; border: none; color: var(--error); cursor: pointer; font-size: 1.2rem;" onclick="removeStyleSample(${index})">&times;</button>
                    ${sample.length > 100 ? sample.substring(0, 100) + '...' : sample}
                </div>
            `).join('');
        }

        // 통계 업데이트
        function updateStats() {
            const total = topics.length;
            const completed = topics.filter(t => t.status === 'completed').length;
            const pending = topics.filter(t => t.status === 'pending').length;

            document.getElementById('totalTopics').textContent = total;
            document.getElementById('completedTopics').textContent = completed;
            document.getElementById('pendingTopics').textContent = pending;
        }

        // 주제 선택
        function selectTopic(topicId) {
            const topic = topics.find(t => t.id === topicId);
            if (!topic) return;

            currentTopicId = topicId;
            
            document.getElementById('editorTitle').textContent = `✍️ ${topic.content.split('\n')[0].substring(0, 30)}...`;
            document.getElementById('editorSubtitle').textContent = `상태: ${getStatusText(topic.status)}`;

            if (topic.generatedPost) {
                document.getElementById('editorContent').textContent = topic.generatedPost.content;
            } else {
                document.getElementById('editorContent').textContent = '선택된 주제입니다. "글 생성" 버튼을 클릭하여 AI가 글을 써드리도록 하세요.';
            }
        }

        // 글 생성 (임시 구현)
        async function generatePost(topicId) {
            const topic = topics.find(t => t.id === topicId);
            if (!topic) return;

            topic.status = 'in-progress';
            renderTopicList();
            updateStats();

            const loading = document.getElementById('generationLoading');
            const content = document.getElementById('editorContent');
            loading.classList.add('active');
            content.style.display = 'none';

            try {
                // 실제 AI API 호출은 여기서 구현
                await new Promise(resolve => setTimeout(resolve, 3000)); // 시뮬레이션

                const generatedPost = {
                    title: topic.content.split('\n')[0].replace(/^[📌-]*\s*/, '') + ' - 완벽 가이드',
                    content: `# ${topic.content.split('\n')[0].replace(/^[📌-]*\s*/, '')}

안녕하세요! 오늘은 정말 중요한 이야기를 해보려고 해요.

${topic.content}

이런 고민을 해결하는 완벽한 방법들을 알려드릴게요!

## 주요 포인트들

1. **기본 원리 이해하기**
2. **실전 적용 방법**
3. **주의사항과 팁들**

자세한 내용은 계속해서 업데이트됩니다...`,
                    quality: 85 + Math.floor(Math.random() * 15)
                };

                topic.generatedPost = generatedPost;
                topic.status = 'completed';
                
                if (currentUser && db && !offlineMode) {
                    await db.collection('users').doc(currentUser.uid).collection('topics').doc(topic.id).update({
                        generatedPost: generatedPost,
                        status: 'completed'
                    });
                }

                saveOfflineData();
                renderTopicList();
                updateStats();

                document.getElementById('editorContent').textContent = generatedPost.content;
                showAlert('success', '✨ 글 생성이 완료되었습니다!');

            } catch (error) {
                topic.status = 'pending';
                showAlert('error', '글 생성 중 오류가 발생했습니다: ' + error.message);
            } finally {
                loading.classList.remove('active');
                content.style.display = 'block';
            }
        }

        // 배치 생성 시작
        async function startBatchGeneration() {
            const pendingTopics = topics.filter(t => t.status === 'pending');
            
            if (pendingTopics.length === 0) {
                showAlert('warning', '생성할 주제가 없습니다.');
                return;
            }

            if (!confirm(`${pendingTopics.length}개의 주제를 모두 글로 생성하시겠습니까?`)) {
                return;
            }

            for (let i = 0; i < pendingTopics.length; i++) {
                const topic = pendingTopics[i];
                showAlert('info', `${i + 1}/${pendingTopics.length} 생성 중: ${topic.content.substring(0, 30)}...`);
                await generatePost(topic.id);
                await new Promise(resolve => setTimeout(resolve, 1000));
            }

            showAlert('success', `🎉 배치 생성 완료! ${pendingTopics.length}개의 글이 생성되었습니다.`);
        }

        // 주제 삭제
        async function deleteTopic(topicId) {
            if (!confirm('이 주제를 삭제하시겠습니까?')) return;
            
            try {
                if (currentUser && db && !offlineMode) {
                    await db.collection('users').doc(currentUser.uid).collection('topics').doc(topicId).delete();
                }

                topics = topics.filter(t => t.id !== topicId);
                saveOfflineData();
                updateUI();
                
                if (currentTopicId === topicId) {
                    document.getElementById('editorContent').textContent = '주제를 선택해주세요.';
                    currentTopicId = null;
                }

                showAlert('success', '주제가 삭제되었습니다.');

            } catch (error) {
                showAlert('error', '삭제 실패: ' + error.message);
            }
        }

        // 스타일 샘플 제거
        async function removeStyleSample(index) {
            try {
                writingStyleSamples.splice(index, 1);
                saveOfflineData();
                renderStyleSamples();
                showAlert('success', '스타일 샘플이 제거되었습니다.');
            } catch (error) {
                showAlert('error', '제거 실패: ' + error.message);
            }
        }

        // 글쓰기 스타일 분석
        function analyzeWritingStyle() {
            if (writingStyleSamples.length === 0) {
                showAlert('warning', '먼저 글쓰기 스타일 샘플을 추가해주세요.');
                return;
            }

            const combinedText = writingStyleSamples.join(' ');
            
            const analysis = {
                tone: combinedText.includes('😊') || combinedText.includes('💕') ? '친근함' : '전문적',
                formality: combinedText.includes('요!') || combinedText.includes('해요') ? '캐주얼' : '격식',
                emoji: /[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/u.test(combinedText) ? '자주 사용' : '거의 사용 안함',
                personality: combinedText.includes('정말') || combinedText.includes('완전') ? '열정적' : '차분함'
            };

            const message = `📊 분석된 글쓰기 스타일:

🎭 톤: ${analysis.tone}
📝 문체: ${analysis.formality}
😊 이모지 사용: ${analysis.emoji}
💭 성격: ${analysis.personality}

AI가 이 스타일을 학습해서 비슷하게 글을 써드릴게요!`;

            showAlert('info', message);
        }

        // 현재 글 저장
        function saveCurrentPost() {
            if (!currentTopicId) {
                showAlert('warning', '저장할 글이 없습니다.');
                return;
            }

            showAlert('success', '글이 저장되었습니다.');
        }

        // 블로그 발행
        function publishPost(topicId = null) {
            const targetId = topicId || currentTopicId;
            if (!targetId) {
                showAlert('warning', '발행할 글을 선택해주세요.');
                return;
            }

            showAlert('success', '블로그에 발행되었습니다! (실제 연동 시 자동 발행됩니다)');
        }

        // 오프라인 옵션 표시
        function showOfflineOption() {
            showAlert('warning', `
Firebase 연결에 실패했습니다.

📱 오프라인 모드로 계속 사용하시거나
🔧 Firebase 설정을 확인해주세요.

오프라인 모드에서는:
- 데이터가 로컬에만 저장됩니다
- 다른 기기와 동기화되지 않습니다
- API 키가 안전하지 않게 저장됩니다
            `);
        }

        // 유틸리티 함수들
        function getStatusClass(status) {
            switch(status) {
                case 'completed': return 'completed';
                case 'in-progress': return 'progress';
                default: return 'pending';
            }
        }

        function getStatusText(status) {
            switch(status) {
                case 'completed': return '✅ 완료';
                case 'in-progress': return '⏳ 생성 중';
                default: return '⭕ 대기 중';
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' });
        }

        function showAlert(type, message) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${type}`;
            alertDiv.innerHTML = `
                <strong>${type === 'success' ? '✅' : type === 'warning' ? '⚠️' : type === 'error' ? '❌' : 'ℹ️'}</strong> 
                ${message.replace(/\n/g, '<br>')}
            `;
            
            const container = document.querySelector('.container');
            container.insertBefore(alertDiv, container.firstChild);
            
            setTimeout(() => {
                alertDiv.remove();
            }, type === 'info' ? 8000 : 5000);
        }
    </script>
</body>
</html>
